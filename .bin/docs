#!/usr/bin/env node
const fs = require('fs-extra');
const path = require('path');
const cp = require('child_process');

const exec = (cmd) => cp.execSync(cmd).toString().trim();

const createApiDocs = (pkg) => {
  console.log(`creating API docs for ${pkg}`);
  const template = path.resolve(__dirname, '../templates/packages/docs/api.md.hbs');
  const input = path.resolve(__dirname, '../packages', pkg, 'lib/**/*.js');
  const output = path.resolve(__dirname, '../packages', pkg, 'docs/api.md');
  const docsFolder = path.resolve(__dirname, '../packages', pkg, 'docs');
  if (!fs.existsSync(docsFolder)) {
    fs.mkdirpSync(docsFolder);
  }

  const cmd = `npx jsdoc2md
  --template ${template}
  --files ${input} > ${output}`;
  exec(cmd);
};

const packages = fs.readdirSync(path.resolve(__dirname, '../packages'));
packages.forEach((pkg) => {
  createApiDocs(pkg);
});
// console.log(packages);
